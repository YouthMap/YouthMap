{% extends "base-std.html" %}
{% block content %}

<!--suppress HtmlUnknownAttribute, HtmlUnknownTarget  -->
{% if station_type == "perm" %}
<h2 class="mb-5">Create {{ type.name }} Station</h2>
{% else %}
<h2 class="mb-5">Create {{ event.name if event else "Event" }} Station</h2>
{% end %}

<div class="alert alert-warning mb-5" role="alert">
    <h5 class="alert-warning"><svg class="bi flex-shrink-0 me-2 alert-icon" role="img" aria-label="Warning:"><use xlink:href="#exclamation-triangle-fill"/></svg> Entering publicly-visible information</h5>
    <p class="mb-0">Information you enter on this form, such as an email address and telephone number, is displayed publicly on the website to help potential visitors to your station to get in touch with you. If you don't want such information to be public, please don't enter it here.</p>
</div>

<div class="row">
    <div class="col-sm-6 mb-3">
        <div class="card mx-auto bg-body-tertiary">
            <div class="card-header">
                <h5 class="mb-0 card-title">Refine Location</h5>
            </div>

            <div class="card-body p-0">
                <div id="map" style="width: 100%; height: 20em;"></div>
            </div>

            <p class="mt-3 mx-3">To refine the location of your station, drag the marker to a new location on the
                map.</p>
        </div>
    </div>

    <div class="col-sm-6">
        <div class="card mx-auto bg-body-tertiary">
            <div class="card-header">
                <h5 class="mb-0 card-title">Set Details</h5>
            </div>

            <div class="card-body">
                <form method="post">
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="callsign" class="form-label mt-2">Callsign:</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="callsign" class="form-control" name="callsign" required/>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="club_name" class="form-label mt-2">Club/station name:</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="club_name" class="form-control" name="club_name" required/>
                        </div>
                    </div>

                    {% if station_type == "temp" %}
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="start_time" class="form-label mt-2">Start time (UTC):</label>
                        </div>
                        <div class="col-sm-8">
                            <input id="start_time" class="form-control" name="start_time" type="datetime-local"
                                   value="{{ (event.start_time if event else default_start).strftime('%Y-%m-%dT%H:%M') }}" required/>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="end_time" class="form-label mt-2">End time (UTC):</label>
                        </div>
                        <div class="col-sm-8">
                            <input id="end_time" class="form-control" name="end_time" type="datetime-local"
                                   value="{{ (event.end_time if event else default_end).strftime('%Y-%m-%dT%H:%M') }}" required/>
                        </div>
                    </div>

                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label class="form-label">Bands:</label>
                        </div>
                        <div class="col-sm-8">
                            {% for band in all_bands %}
                            <span style="display:inline-block; min-width:5em;">
                    <input type="checkbox" id="band-{{ band.id }}" class="form-check-input" name="bands[]"
                           value="{{ band.id }}"/>&nbsp;
                    <label for="band-{{ band.id }}" class="form-check-label">{{ band.name }}</label>
                    </span>
                            {% end %}
                            <a href="#/" class="ms-4 link-underline link-underline-opacity-0"
                               onClick="$(':input:checkbox[name=\'bands[]\']').prop('checked', true);">All</a>
                            <a href="#/" class="ms-2 link-underline link-underline-opacity-0"
                               onClick="$(':input:checkbox[name=\'bands[]\']').prop('checked', false);">None</a>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label class="form-label">Modes:</label>
                        </div>
                        <div class="col-sm-8">
                            {% for mode in all_modes %}
                            <span style="display:inline-block; min-width:5em;">
                    <input type="checkbox" id="mode-{{ mode.id }}" class="form-check-input" name="modes[]"
                           value="{{ mode.id }}"/>&nbsp;
                    <label for="mode-{{ mode.id }}" class="form-check-label">{{ mode.name }}</label>
                    </span>
                            {% end %}
                        </div>
                    </div>
                    {% end %}

                    {% if station_type == "perm" %}
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="meeting_when" class="form-label mt-2">Meeting times:</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="meeting_when" class="form-control" name="meeting_when"/>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="meeting_where" class="form-label mt-2">Meeting place:</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="meeting_where" class="form-control" name="meeting_where"/>
                        </div>
                    </div>
                    {% end %}

                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="notes" class="form-label mt-2">Notes (optional):</label>
                        </div>
                        <div class="col-sm-8">
                            <textarea id="notes" class="form-control" name="notes" rows="5">{{ event.notes_template if event and event.notes_template else "" }}</textarea>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="website_url" class="form-label mt-2">Website (optional):</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="website_url" class="form-control" name="website_url" />
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="qrz_url" class="form-label mt-2">QRZ Page (optional):</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="qrz_url" class="form-control" name="qrz_url" />
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="social_media_url" class="form-label mt-2">Social media (optional):</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="social_media_url" class="form-control" name="social_media_url" />
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="email" class="form-label mt-2">Email address (optional):</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="email" class="form-control" name="email" />
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4">
                            <label for="phone_number" class="form-label mt-2">Phone (optional):</label>
                        </div>
                        <div class="col-sm-8">
                            <input type="text" id="phone_number" class="form-control" name="phone_number" />
                        </div>
                    </div>
                    <div class="row mb-2 mt-4">
                        <div class="col-sm-4">
                        </div>
                        <div class="col-sm-8">
                            <input type="submit" class="btn btn-primary" name="action" value="Create">
                            <a href="/create/station/type?lat={{ latitude_degrees }}&lon={{ longitude_degrees }}" class="btn btn-secondary" role="button">Back</a>
                            <a href="/" class="btn btn-secondary" role="button">Cancel</a>
                        </div>
                    </div>

                    <!-- lat/long fields set by GET params and updated by dragging the map marker; event_id and type_id provided by GET params. -->
                    <input type="hidden" id="latitude_degrees" class="form-control" name="latitude_degrees"
                           value="{{ latitude_degrees }}" required/>
                    <input type="hidden" id="longitude_degrees" class="form-control" name="longitude_degrees"
                           value="{{ longitude_degrees }}" required/>
                    <input type="hidden" id="type_id" class="form-control" name="type_id" value="{{ type_id }}"/>
                    <input type="hidden" id="event_id" class="form-control" name="event_id" value="{{ event_id }}"/>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="importmap">
    {
      "imports": {
        "leaflet": "https://unpkg.com/leaflet@2.0.0-alpha.1/dist/leaflet.js",
        "leaflet-extra-markers": "https://unpkg.com/leaflet-extra-markers@2.0.1/src/index.js"
      }
    }
</script>
<script>
    let latitude_degrees = {{ float(latitude_degrees) }};
    let longitude_degrees = {{ float(longitude_degrees) }};
    let color = "{{ color }}";
    let icon = "{{ icon }}";
    let default_zoom = 12;
</script>
<script type="module" src="/js/map-editstation.js?v=1"></script>
{% end %}